{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.ParallaxImageStatus = void 0;\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _ParallaxImage = _interopRequireDefault(require(\"./ParallaxImage.style\"));\n\nvar _excluded = [\"scrollPosition\", \"dimensions\", \"parallaxFactor\", \"style\", \"AnimatedImageComponent\"];\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar ParallaxImageStatus;\nexports.ParallaxImageStatus = ParallaxImageStatus;\n\n(function (ParallaxImageStatus) {\n  ParallaxImageStatus[ParallaxImageStatus[\"LOADING\"] = 1] = \"LOADING\";\n  ParallaxImageStatus[ParallaxImageStatus[\"LOADED\"] = 2] = \"LOADED\";\n  ParallaxImageStatus[ParallaxImageStatus[\"TRANSITION_FINISHED\"] = 3] = \"TRANSITION_FINISHED\";\n  ParallaxImageStatus[ParallaxImageStatus[\"ERROR\"] = 4] = \"ERROR\";\n})(ParallaxImageStatus || (exports.ParallaxImageStatus = ParallaxImageStatus = {}));\n\nvar ParallaxImage = function (_Component) {\n  (0, _inherits2.default)(ParallaxImage, _Component);\n\n  var _super = _createSuper(ParallaxImage);\n\n  function ParallaxImage(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, ParallaxImage);\n    _this = _super.call(this, props);\n\n    _defineProperty((0, _assertThisInitialized2.default)(_this), \"_container\", void 0);\n\n    _defineProperty((0, _assertThisInitialized2.default)(_this), \"_mounted\", void 0);\n\n    _this.state = {\n      offset: 0,\n      width: 0,\n      height: 0,\n      status: ParallaxImageStatus.LOADING,\n      animOpacity: new _reactNative.Animated.Value(0)\n    };\n    _this._onLoad = _this._onLoad.bind((0, _assertThisInitialized2.default)(_this));\n    _this._onError = _this._onError.bind((0, _assertThisInitialized2.default)(_this));\n    _this._measureLayout = _this._measureLayout.bind((0, _assertThisInitialized2.default)(_this));\n    return _this;\n  }\n\n  (0, _createClass2.default)(ParallaxImage, [{\n    key: \"setNativeProps\",\n    value: function setNativeProps(nativeProps) {\n      var _this$_container;\n\n      (_this$_container = this._container) === null || _this$_container === void 0 ? void 0 : _this$_container.setNativeProps(nativeProps);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this._mounted = true;\n      setTimeout(function () {\n        _this2._measureLayout();\n      }, 0);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._mounted = false;\n    }\n  }, {\n    key: \"_measureLayout\",\n    value: function _measureLayout() {\n      var _this3 = this;\n\n      if (this._container) {\n        var _this$props = this.props,\n            dimensions = _this$props.dimensions,\n            carouselRef = _this$props.carouselRef;\n        var nodeHandle = (0, _reactNative.findNodeHandle)(carouselRef);\n\n        if (carouselRef && nodeHandle) {\n          this._container.measureLayout(nodeHandle, function (x, y, width, height) {\n            var offset = _this3.props.vertical ? y - (_this3.props.sliderHeight - _this3.props.itemHeight) / 2 : x - (_this3.props.sliderWidth - _this3.props.itemWidth) / 2;\n\n            _this3.setState({\n              offset: offset,\n              width: dimensions && dimensions.width ? dimensions.width : Math.ceil(width),\n              height: dimensions && dimensions.height ? dimensions.height : Math.ceil(height)\n            });\n          }, function () {});\n        }\n      }\n    }\n  }, {\n    key: \"_onLoad\",\n    value: function _onLoad(event) {\n      var _this4 = this;\n\n      var animOpacity = this.state.animOpacity;\n      var _this$props2 = this.props,\n          fadeDuration = _this$props2.fadeDuration,\n          onLoad = _this$props2.onLoad;\n\n      if (!this._mounted) {\n        return;\n      }\n\n      this.setState({\n        status: ParallaxImageStatus.LOADED\n      });\n\n      if (onLoad) {\n        onLoad(event);\n      }\n\n      _reactNative.Animated.timing(animOpacity, {\n        toValue: 1,\n        duration: fadeDuration,\n        easing: _reactNative.Easing.out(_reactNative.Easing.quad),\n        isInteraction: false,\n        useNativeDriver: true\n      }).start(function () {\n        _this4.setState({\n          status: ParallaxImageStatus.TRANSITION_FINISHED\n        });\n      });\n    }\n  }, {\n    key: \"_onError\",\n    value: function _onError(event) {\n      var onError = this.props.onError;\n      this.setState({\n        status: ParallaxImageStatus.ERROR\n      });\n\n      if (onError) {\n        onError(event);\n      }\n    }\n  }, {\n    key: \"image\",\n    get: function get() {\n      var _this$state = this.state,\n          status = _this$state.status,\n          animOpacity = _this$state.animOpacity,\n          offset = _this$state.offset,\n          width = _this$state.width,\n          height = _this$state.height;\n      var _this$props3 = this.props,\n          scrollPosition = _this$props3.scrollPosition,\n          dimensions = _this$props3.dimensions,\n          parallaxFactor = _this$props3.parallaxFactor,\n          style = _this$props3.style,\n          AnimatedImageComponent = _this$props3.AnimatedImageComponent,\n          other = (0, _objectWithoutProperties2.default)(_this$props3, _excluded);\n      var parallaxPadding = (this.props.vertical ? height : width) * parallaxFactor;\n      var requiredStyles = {\n        position: 'relative'\n      };\n      var dynamicStyles = {\n        width: this.props.vertical ? width : width + parallaxPadding * 2,\n        height: this.props.vertical ? height + parallaxPadding * 2 : height,\n        opacity: animOpacity,\n        transform: scrollPosition ? [{\n          translateX: !this.props.vertical ? scrollPosition.interpolate({\n            inputRange: [offset - this.props.sliderWidth, offset + this.props.sliderWidth],\n            outputRange: [-parallaxPadding, parallaxPadding],\n            extrapolate: 'clamp'\n          }) : 0\n        }, {\n          translateY: this.props.vertical ? scrollPosition.interpolate({\n            inputRange: [offset - this.props.sliderHeight, offset + this.props.sliderHeight],\n            outputRange: [-parallaxPadding, parallaxPadding],\n            extrapolate: 'clamp'\n          }) : 0\n        }] : []\n      };\n      return _react.default.createElement(AnimatedImageComponent, _extends({}, other, {\n        style: [_ParallaxImage.default.image, style, requiredStyles, dynamicStyles],\n        onLoad: this._onLoad,\n        onError: status !== ParallaxImageStatus.TRANSITION_FINISHED ? this._onError : undefined\n      }));\n    }\n  }, {\n    key: \"spinner\",\n    get: function get() {\n      var status = this.state.status;\n      var _this$props4 = this.props,\n          showSpinner = _this$props4.showSpinner,\n          spinnerColor = _this$props4.spinnerColor;\n      return status === ParallaxImageStatus.LOADING && showSpinner ? _react.default.createElement(_reactNative.View, {\n        style: _ParallaxImage.default.loaderContainer\n      }, _react.default.createElement(_reactNative.ActivityIndicator, {\n        size: \"small\",\n        color: spinnerColor,\n        animating: true\n      })) : false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      var containerStyle = this.props.containerStyle;\n      return _react.default.createElement(_reactNative.View, {\n        ref: function ref(c) {\n          _this5._container = c;\n        },\n        pointerEvents: \"none\",\n        style: [containerStyle, _ParallaxImage.default.container],\n        onLayout: this._measureLayout\n      }, this.image, this.spinner);\n    }\n  }]);\n  return ParallaxImage;\n}(_react.Component);\n\nexports.default = ParallaxImage;\n\n_defineProperty(ParallaxImage, \"defaultProps\", {\n  containerStyle: {},\n  fadeDuration: 500,\n  parallaxFactor: 0.3,\n  showSpinner: true,\n  spinnerColor: 'rgba(0, 0, 0, 0.4)',\n  AnimatedImageComponent: _reactNative.Animated.Image\n});","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;AAEA;;AACA;;AAaA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,IAAYA,mBAAZ;;;WAAYA,qB;EAAAA,mB,CAAAA,mB,WAAAA,G,EAAAA,G,SAAAA;EAAAA,mB,CAAAA,mB,UAAAA,G,EAAAA,G,QAAAA;EAAAA,mB,CAAAA,mB,uBAAAA,G,EAAAA,G,qBAAAA;EAAAA,mB,CAAAA,mB,SAAAA,G,EAAAA,G,OAAAA;GAAAA,mB,mCAAAA,mB;;IAeSC,a;;;;;EAgBnBC,uBAAaC,KAAbD,EAAwC;IAAA;;IAAA;IACpC,0BAAMC,KAAN;;IADoCC;;IAAAA;;IAEpC,MAAKC,KAAL,GAAa;MACTC,MAAM,EAAE,CADC;MAETC,KAAK,EAAE,CAFE;MAGTC,MAAM,EAAE,CAHC;MAITC,MAAM,EAAET,mBAAmB,CAACU,OAJnB;MAKTC,WAAW,EAAE,IAAIC,sBAASC,KAAb,CAAmB,CAAnB;IALJ,CAAb;IAOA,MAAKC,OAAL,GAAe,MAAKA,OAAL,CAAaC,IAAb,6CAAf;IACA,MAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcD,IAAd,6CAAhB;IACA,MAAKE,cAAL,GAAsB,MAAKA,cAAL,CAAoBF,IAApB,6CAAtB;IAXoC;EAYvC;;;;WAEDG,wBAAgBC,WAAhBD,EAAyD;MAAA;;MACvD,yBAAKE,UAAL,sEAAiBF,cAAjB,CAAgCC,WAAhC;IACD;;;WAEDE,6BAAqB;MAAA;;MACjB,KAAKC,QAAL,GAAgB,IAAhB;MAEAC,UAAU,CAAC,YAAM;QACb,OAAKN,cAAL;MADM,GAEP,CAFO,CAAVM;IAGH;;;WAEDC,gCAAwB;MACpB,KAAKF,QAAL,GAAgB,KAAhB;IACH;;;WAEDL,0BAAkB;MAAA;;MACd,IAAI,KAAKG,UAAT,EAAqB;QACjB,kBAGI,KAAKjB,KAHT;QAAA,IACIsB,UADJ,eACIA,UADJ;QAAA,IAEIC,WAFJ,eAEIA,WAFJ;QAKA,IAAMC,UAAU,GAAGC,iCAAeF,WAAfE,CAAnB;;QAEA,IAAIF,WAAW,IAAIC,UAAnB,EAA+B;UAC3B,KAAKP,UAAL,CAAgBS,aAAhB,CACIF,UADJ,EAEI,UAACG,CAAD,EAAIC,CAAJ,EAAOxB,KAAP,EAAcC,MAAd,EAAyB;YACrB,IAAMF,MAAM,GAAG,OAAKH,KAAL,CAAW6B,QAAX,GACXD,CAAC,GAAG,CAAC,OAAK5B,KAAL,CAAW8B,YAAX,GAA0B,OAAK9B,KAAL,CAAW+B,UAAtC,IAAoD,CAD7C,GAEXJ,CAAC,GAAG,CAAC,OAAK3B,KAAL,CAAWgC,WAAX,GAAyB,OAAKhC,KAAL,CAAWiC,SAArC,IAAkD,CAF1D;;YAIA,OAAKC,QAAL,CAAc;cACV/B,MAAM,EAAEA,MADE;cAEVC,KAAK,EACfkB,UAAU,IAAIA,UAAU,CAAClB,KAAzBkB,GACIA,UAAU,CAAClB,KADfkB,GAEIa,IAAI,CAACC,IAALD,CAAU/B,KAAV+B,CALgB;cAMV9B,MAAM,EAChBiB,UAAU,IAAIA,UAAU,CAACjB,MAAzBiB,GACIA,UAAU,CAACjB,MADfiB,GAEIa,IAAI,CAACC,IAALD,CAAU9B,MAAV8B;YATgB,CAAd;UAPR,GAoBI,YAAM,CApBV;QAsBH;MACJ;IACJ;;;WAEDxB,iBAAS0B,KAAT1B,EAA0D;MAAA;;MACtD,IAAQH,WAAR,GAAwB,KAAKN,KAA7B,CAAQM,WAAR;MACA,mBAAiC,KAAKR,KAAtC;MAAA,IAAQsC,YAAR,gBAAQA,YAAR;MAAA,IAAsBC,MAAtB,gBAAsBA,MAAtB;;MAEA,IAAI,CAAC,KAAKpB,QAAV,EAAoB;QAChB;MACH;;MAED,KAAKe,QAAL,CAAc;QAAE5B,MAAM,EAAET,mBAAmB,CAAC2C;MAA9B,CAAd;;MAEA,IAAID,MAAJ,EAAY;QACRA,MAAM,CAACF,KAAD,CAANE;MACH;;MAED9B,sBAASgC,MAAThC,CAAgBD,WAAhBC,EAA6B;QACzBiC,OAAO,EAAE,CADgB;QAEzBC,QAAQ,EAAEL,YAFe;QAGzBM,MAAM,EAAEC,oBAAOC,GAAPD,CAAWA,oBAAOE,IAAlBF,CAHiB;QAIzBG,aAAa,EAAE,KAJU;QAKzBC,eAAe,EAAE;MALQ,CAA7BxC,EAMGyC,KANHzC,CAMS,YAAM;QACX,OAAKyB,QAAL,CAAc;UAAE5B,MAAM,EAAET,mBAAmB,CAACsD;QAA9B,CAAd;MAPJ;IA7FJ;;;WAyGAtC,kBAAUwB,KAAVxB,EAA4D;MACxD,IAAQuC,OAAR,GAAoB,KAAKpD,KAAzB,CAAQoD,OAAR;MAEA,KAAKlB,QAAL,CAAc;QAAE5B,MAAM,EAAET,mBAAmB,CAACwD;MAA9B,CAAd;;MAEA,IAAID,OAAJ,EAAa;QACTA,OAAO,CAACf,KAAD,CAAPe;MACH;IACJ;;;SAED,eAAa;MACT,kBAAuD,KAAKlD,KAA5D;MAAA,IAAQI,MAAR,eAAQA,MAAR;MAAA,IAAgBE,WAAhB,eAAgBA,WAAhB;MAAA,IAA6BL,MAA7B,eAA6BA,MAA7B;MAAA,IAAqCC,KAArC,eAAqCA,KAArC;MAAA,IAA4CC,MAA5C,eAA4CA,MAA5C;MACA,mBASI,KAAKL,KATT;MAAA,IACIsD,cADJ,gBACIA,cADJ;MAAA,IAIIhC,UAJJ,gBAIIA,UAJJ;MAAA,IAKIiC,cALJ,gBAKIA,cALJ;MAAA,IAMIC,KANJ,gBAMIA,KANJ;MAAA,IAOIC,sBAPJ,gBAOIA,sBAPJ;MAAA,IAQOC,KARP;MAUA,IAAMC,eAAe,GAAG,CAAC,KAAK3D,KAAL,CAAW6B,QAAX,GAAsBxB,MAAtB,GAA+BD,KAAhC,IAAyCmD,cAAjE;MACA,IAAMK,cAAc,GAAG;QAAEC,QAAQ,EAAE;MAAZ,CAAvB;MACA,IAAMC,aAAa,GAAG;QAClB1D,KAAK,EAAE,KAAKJ,KAAL,CAAW6B,QAAX,GAAsBzB,KAAtB,GAA8BA,KAAK,GAAGuD,eAAe,GAAG,CAD7C;QAElBtD,MAAM,EAAE,KAAKL,KAAL,CAAW6B,QAAX,GAAsBxB,MAAM,GAAGsD,eAAe,GAAG,CAAjD,GAAqDtD,MAF3C;QAGlB0D,OAAO,EAAEvD,WAHS;QAIlBwD,SAAS,EAAEV,cAAc,GACrB,CACI;UACIW,UAAU,EAAE,CAAC,KAAKjE,KAAL,CAAW6B,QAAZ,GACRyB,cAAc,CAACY,WAAfZ,CAA2B;YACvBa,UAAU,EAAE,CAAChE,MAAM,GAAG,KAAKH,KAAL,CAAWgC,WAArB,EAAkC7B,MAAM,GAAG,KAAKH,KAAL,CAAWgC,WAAtD,CADW;YAEvBoC,WAAW,EAAE,CAAC,CAACT,eAAF,EAAmBA,eAAnB,CAFU;YAGvBU,WAAW,EAAE;UAHU,CAA3Bf,CADQ,GAMR;QAPR,CADJ,EAUI;UACIgB,UAAU,EAAE,KAAKtE,KAAL,CAAW6B,QAAX,GACRyB,cAAc,CAACY,WAAfZ,CAA2B;YACvBa,UAAU,EAAE,CAAChE,MAAM,GAAG,KAAKH,KAAL,CAAW8B,YAArB,EAAmC3B,MAAM,GAAG,KAAKH,KAAL,CAAW8B,YAAvD,CADW;YAEvBsC,WAAW,EAAE,CAAC,CAACT,eAAF,EAAmBA,eAAnB,CAFU;YAGvBU,WAAW,EAAE;UAHU,CAA3Bf,CADQ,GAMR;QAPR,CAVJ,CADqB,GAqBrB;MAzBc,CAAtB;MA4BA,OACIiB,6BAACd,sBAAD,eACMC,KADN;QAEEF,KAAK,EAAE,CAACgB,uBAAOC,KAAR,EAAejB,KAAf,EAAsBI,cAAtB,EAAsCE,aAAtC,CAFT;QAGEvB,MAAM,EAAE,KAAK5B,OAHf;QAIEyC,OAAO,EAAE9C,MAAM,KAAKT,mBAAmB,CAACsD,mBAA/B7C,GAAqD,KAAKO,QAA1DP,GAAqEoE;MAJhF,GADJ;IAQH;;;SAED,eAAe;MACX,IAAQpE,MAAR,GAAmB,KAAKJ,KAAxB,CAAQI,MAAR;MACA,mBAAsC,KAAKN,KAA3C;MAAA,IAAQ2E,WAAR,gBAAQA,WAAR;MAAA,IAAqBC,YAArB,gBAAqBA,YAArB;MAEA,OAAOtE,MAAM,KAAKT,mBAAmB,CAACU,OAA/BD,IAA0CqE,WAA1CrE,GACHiE,6BAACM,iBAAD;QAAMrB,KAAK,EAAEgB,uBAAOM;MAApB,GACIP,6BAACQ,8BAAD;QACEC,IAAI,EAAC,OADP;QAEEC,KAAK,EAAEL,YAFT;QAGEM,SAAS,EAAE;MAHb,EADJ,CADG5E,GASH,KATJ;IAWH;;;WAED6E,kBAAU;MAAA;;MACN,IAAQC,cAAR,GAA2B,KAAKpF,KAAhC,CAAQoF,cAAR;MAEA,OACIb,6BAACM,iBAAD;QACEQ,GAAG,EAAGC,cAAD,EAAO;UACR,OAAKrE,UAAL,GAAkBqE,CAAlB;QAFN;QAIEC,aAAa,EAAC,MAJhB;QAKE/B,KAAK,EAAE,CAAC4B,cAAD,EAAiBZ,uBAAOgB,SAAxB,CALT;QAMEC,QAAQ,EAAE,KAAK3E;MANjB,GAQK,KAAK2D,KARV,EASK,KAAKiB,OATV,CADJ;IAaH;;;EA3MwCC,gB;;;;gBAAtB7F,e,gBAIG;EAClBsF,cAAc,EAAE,EADE;EAElB9C,YAAY,EAAE,GAFI;EAGlBiB,cAAc,EAAE,GAHE;EAIlBoB,WAAW,EAAE,IAJK;EAKlBC,YAAY,EAAE,oBALI;EAMlBnB,sBAAsB,EAAEhD,sBAASmF;AANf","names":["ParallaxImageStatus","ParallaxImage","constructor","props","_defineProperty","state","offset","width","height","status","LOADING","animOpacity","Animated","Value","_onLoad","bind","_onError","_measureLayout","setNativeProps","nativeProps","_container","componentDidMount","_mounted","setTimeout","componentWillUnmount","dimensions","carouselRef","nodeHandle","findNodeHandle","measureLayout","x","y","vertical","sliderHeight","itemHeight","sliderWidth","itemWidth","setState","Math","ceil","event","fadeDuration","onLoad","LOADED","timing","toValue","duration","easing","Easing","out","quad","isInteraction","useNativeDriver","start","TRANSITION_FINISHED","onError","ERROR","scrollPosition","parallaxFactor","style","AnimatedImageComponent","other","parallaxPadding","requiredStyles","position","dynamicStyles","opacity","transform","translateX","interpolate","inputRange","outputRange","extrapolate","translateY","React","styles","image","undefined","showSpinner","spinnerColor","View","loaderContainer","ActivityIndicator","size","color","animating","render","containerStyle","ref","c","pointerEvents","container","onLayout","spinner","Component","Image"],"sources":["ParallaxImage.tsx"],"sourcesContent":["// Parallax effect inspired by https://github.com/oblador/react-native-parallax/\n\nimport React, { Component } from 'react';\nimport {\n    View,\n    Animated,\n    Easing,\n    ActivityIndicator,\n    findNodeHandle,\n    ImageProps,\n    StyleProp,\n    ViewStyle,\n    NativeSyntheticEvent,\n    ImageLoadEventData,\n    ImageErrorEventData\n} from 'react-native';\nimport styles from './ParallaxImage.style';\n\ntype VerticalProps = {\n    vertical: true;\n    sliderHeight: number; // passed from <Carousel />\n    itemHeight: number; // passed from <Carousel />\n}\ntype HorizontalProps = {\n    vertical: false;\n    sliderWidth: number; // passed from <Carousel />\n    itemWidth: number; // passed from <Carousel />\n}\n\ntype ParallaxImageProps = {\n  carouselRef: Parameters<typeof findNodeHandle>[0]; // passed from <Carousel />\n  scrollPosition: Animated.Value | undefined; // passed from <Carousel />\n  containerStyle: StyleProp<ViewStyle>;\n  dimensions?: {\n    width: number;\n    height: number;\n  };\n  fadeDuration: number;\n  parallaxFactor: number;\n  showSpinner: boolean;\n  spinnerColor: string;\n  AnimatedImageComponent: typeof Animated.Image;\n} & ImageProps & (VerticalProps | HorizontalProps);\n\nexport enum ParallaxImageStatus {\n    'LOADING' = 1,\n    'LOADED' = 2,\n    'TRANSITION_FINISHED' = 3,\n    'ERROR' = 4\n}\n\ntype ParallaxImageState = {\n  offset: number;\n  width: number;\n  height: number;\n  status: ParallaxImageStatus;\n  animOpacity: Animated.Value;\n};\n\nexport default class ParallaxImage extends Component<\n  ParallaxImageProps,\n  ParallaxImageState\n> {\n  static defaultProps = {\n      containerStyle: {},\n      fadeDuration: 500,\n      parallaxFactor: 0.3,\n      showSpinner: true,\n      spinnerColor: 'rgba(0, 0, 0, 0.4)',\n      AnimatedImageComponent: Animated.Image\n  };\n\n  _container?: View | null;\n  _mounted?: boolean;\n\n  constructor (props: ParallaxImageProps) {\n      super(props);\n      this.state = {\n          offset: 0,\n          width: 0,\n          height: 0,\n          status: ParallaxImageStatus.LOADING,\n          animOpacity: new Animated.Value(0)\n      };\n      this._onLoad = this._onLoad.bind(this);\n      this._onError = this._onError.bind(this);\n      this._measureLayout = this._measureLayout.bind(this);\n  }\n\n  setNativeProps (nativeProps: { [key: string]: unknown }) {\n    this._container?.setNativeProps(nativeProps);\n  }\n\n  componentDidMount () {\n      this._mounted = true;\n\n      setTimeout(() => {\n          this._measureLayout();\n      }, 0);\n  }\n\n  componentWillUnmount () {\n      this._mounted = false;\n  }\n\n  _measureLayout () {\n      if (this._container) {\n          const {\n              dimensions,\n              carouselRef\n          } = this.props;\n\n          const nodeHandle = findNodeHandle(carouselRef);\n\n          if (carouselRef && nodeHandle) {\n              this._container.measureLayout(\n                  nodeHandle,\n                  (x, y, width, height) => {\n                      const offset = this.props.vertical ?\n                          y - (this.props.sliderHeight - this.props.itemHeight) / 2 :\n                          x - (this.props.sliderWidth - this.props.itemWidth) / 2;\n\n                      this.setState({\n                          offset: offset,\n                          width:\n                dimensions && dimensions.width ?\n                    dimensions.width :\n                    Math.ceil(width),\n                          height:\n                dimensions && dimensions.height ?\n                    dimensions.height :\n                    Math.ceil(height)\n                      });\n                  },\n                  // eslint-disable-next-line @typescript-eslint/no-empty-function\n                  () => {}\n              );\n          }\n      }\n  }\n\n  _onLoad (event: NativeSyntheticEvent<ImageLoadEventData>) {\n      const { animOpacity } = this.state;\n      const { fadeDuration, onLoad } = this.props;\n\n      if (!this._mounted) {\n          return;\n      }\n\n      this.setState({ status: ParallaxImageStatus.LOADED });\n\n      if (onLoad) {\n          onLoad(event);\n      }\n\n      Animated.timing(animOpacity, {\n          toValue: 1,\n          duration: fadeDuration,\n          easing: Easing.out(Easing.quad),\n          isInteraction: false,\n          useNativeDriver: true\n      }).start(() => {\n          this.setState({ status: ParallaxImageStatus.TRANSITION_FINISHED });\n      });\n  }\n\n  // If arg is missing from method signature, it just won't be called\n  _onError (event: NativeSyntheticEvent<ImageErrorEventData>) {\n      const { onError } = this.props;\n\n      this.setState({ status: ParallaxImageStatus.ERROR });\n\n      if (onError) {\n          onError(event);\n      }\n  }\n\n  get image () {\n      const { status, animOpacity, offset, width, height } = this.state;\n      const {\n          scrollPosition,\n          // False positive :( other doesn't have the dimension key\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          dimensions,\n          parallaxFactor,\n          style,\n          AnimatedImageComponent,\n          ...other\n      } = this.props;\n      const parallaxPadding = (this.props.vertical ? height : width) * parallaxFactor;\n      const requiredStyles = { position: 'relative' as const };\n      const dynamicStyles = {\n          width: this.props.vertical ? width : width + parallaxPadding * 2,\n          height: this.props.vertical ? height + parallaxPadding * 2 : height,\n          opacity: animOpacity,\n          transform: scrollPosition ?\n              [\n                  {\n                      translateX: !this.props.vertical ?\n                          scrollPosition.interpolate({\n                              inputRange: [offset - this.props.sliderWidth, offset + this.props.sliderWidth],\n                              outputRange: [-parallaxPadding, parallaxPadding],\n                              extrapolate: 'clamp'\n                          }) :\n                          0\n                  },\n                  {\n                      translateY: this.props.vertical ?\n                          scrollPosition.interpolate({\n                              inputRange: [offset - this.props.sliderHeight, offset + this.props.sliderHeight],\n                              outputRange: [-parallaxPadding, parallaxPadding],\n                              extrapolate: 'clamp'\n                          }) :\n                          0\n                  }\n              ] :\n              []\n      };\n\n      return (\n          <AnimatedImageComponent\n            {...other}\n            style={[styles.image, style, requiredStyles, dynamicStyles]}\n            onLoad={this._onLoad}\n            onError={status !== ParallaxImageStatus.TRANSITION_FINISHED ? this._onError : undefined} // prevent infinite-loop bug\n          />\n      );\n  }\n\n  get spinner () {\n      const { status } = this.state;\n      const { showSpinner, spinnerColor } = this.props;\n\n      return status === ParallaxImageStatus.LOADING && showSpinner ? (\n          <View style={styles.loaderContainer}>\n              <ActivityIndicator\n                size='small'\n                color={spinnerColor}\n                animating={true}\n              />\n          </View>\n      ) : (\n          false\n      );\n  }\n\n  render () {\n      const { containerStyle } = this.props;\n\n      return (\n          <View\n            ref={(c) => {\n                this._container = c;\n            }}\n            pointerEvents='none'\n            style={[containerStyle, styles.container]}\n            onLayout={this._measureLayout}\n          >\n              {this.image}\n              {this.spinner}\n          </View>\n      );\n  }\n}\n"]},"metadata":{},"sourceType":"script"}